<script>
        // Проверка пароля при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Admin page loaded');
            
            // Проверяем, загружены ли CONFIG и DataCollector
            if (!window.CONFIG) {
                console.error('CONFIG не загружен!');
                alert('Ошибка: CONFIG не загружен. Проверьте config.js');
                return;
            }
            
            if (!window.DataCollector) {
                console.error('DataCollector не загружен!');
                alert('Ошибка: DataCollector не загружен. Проверьте data.js');
                return;
            }
            
            const savedPassword = localStorage.getItem('admin_authenticated');
            console.log('Сохраненный пароль:', savedPassword ? 'есть' : 'нет');
            console.log('Пароль из CONFIG:', CONFIG.ADMIN_PASSWORD);
            
            if (savedPassword === CONFIG.ADMIN_PASSWORD) {
                console.log('Пароль верный, показываем админку');
                showAdminInterface();
            } else {
                console.log('Показываем модальное окно пароля');
                showPasswordModal();
            }
            
            // Добавляем обработчик закрытия по клику вне модалки
            document.addEventListener('click', function(event) {
                const modal = document.getElementById('passwordModal');
                if (modal && modal.style.display === 'flex') {
                    const modalContent = document.querySelector('.modal-content');
                    if (!modalContent.contains(event.target)) {
                        closePasswordModal();
                    }
                }
                
                const exportModal = document.getElementById('exportModal');
                if (exportModal && exportModal.style.display === 'flex') {
                    const exportContent = exportModal.querySelector('.modal-content');
                    if (!exportContent.contains(event.target)) {
                        closeExportModal();
                    }
                }
            });
            
            // Закрытие по Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closePasswordModal();
                    closeExportModal();
                }
                
                // Автовход для тестирования (Ctrl+Shift+Enter)
                if (e.ctrlKey && e.shiftKey && e.key === 'Enter') {
                    e.preventDefault();
                    autoLogin();
                }
            });
        });
        
        // Показать модальное окно с паролем
        function showPasswordModal() {
            console.log('showPasswordModal вызвана');
            const modal = document.getElementById('passwordModal');
            if (modal) {
                modal.style.display = 'flex';
                // Фокус на поле пароля
                setTimeout(() => {
                    const passField = document.getElementById('adminPassword');
                    if (passField) passField.focus();
                }, 100);
            }
        }
        
        function closePasswordModal() {
            console.log('closePasswordModal вызвана');
            const modal = document.getElementById('passwordModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // Проверить пароль
        function checkPassword() {
            console.log('checkPassword вызвана');
            const passwordInput = document.getElementById('adminPassword');
            if (!passwordInput) {
                alert('Ошибка: поле пароля не найдено');
                return;
            }
            
            const password = passwordInput.value;
            console.log('Введен пароль:', password);
            console.log('Ожидаемый пароль:', CONFIG.ADMIN_PASSWORD);
            
            if (password === CONFIG.ADMIN_PASSWORD) {
                console.log('Пароль верный!');
                localStorage.setItem('admin_authenticated', password);
                showAdminInterface();
                closePasswordModal();
            } else {
                alert('Неверный пароль! Попробуйте: ' + CONFIG.ADMIN_PASSWORD);
                passwordInput.value = '';
                passwordInput.focus();
            }
        }
        
        // Автоматический вход (для тестирования)
        function autoLogin() {
            console.log('autoLogin вызвана');
            localStorage.setItem('admin_authenticated', CONFIG.ADMIN_PASSWORD);
            showAdminInterface();
            closePasswordModal();
        }
        
        // Показать админ интерфейс
        function showAdminInterface() {
            console.log('showAdminInterface вызвана');
            const adminInterface = document.getElementById('adminInterface');
            if (adminInterface) {
                adminInterface.style.display = 'block';
                console.log('Админ интерфейс показан');
                loadAdminData();
                
                // Автообновление
                if (CONFIG.AUTO_REFRESH_DATA) {
                    console.log('Автообновление включено:', CONFIG.REFRESH_INTERVAL + 'мс');
                    setInterval(loadAdminData, CONFIG.REFRESH_INTERVAL);
                }
            } else {
                console.error('Элемент adminInterface не найден!');
            }
        }
        
        // Загрузка данных в админку
        function loadAdminData() {
            console.log('loadAdminData вызвана');
            
            if (!window.DataCollector) {
                console.error('DataCollector не доступен');
                return;
            }
            
            try {
                const data = DataCollector.loadData();
                const stats = DataCollector.getStats();
                
                console.log('Данные загружены:', {
                    users: data.users.length,
                    visits: data.visits.length,
                    stats: stats
                });
                
                // Обновляем статистику
                document.getElementById('totalUsers').textContent = stats.totalUsers;
                document.getElementById('todayLogins').textContent = getTodayLogins(data.users);
                document.getElementById('uniqueIPs').textContent = stats.uniqueIPs;
                document.getElementById('lastLogin').textContent = stats.lastLogin;
                
                // Обновляем таблицу
                updateTable(data.users);
                
                // Обновляем аналитику
                updateAnalytics(data.users);
                
                // Скрываем лоадер
                const loader = document.getElementById('loader');
                if (loader) loader.style.display = 'none';
                
            } catch (error) {
                console.error('Ошибка в loadAdminData:', error);
                document.getElementById('totalUsers').textContent = 'Ошибка';
                document.getElementById('todayLogins').textContent = 'Ошибка';
                document.getElementById('uniqueIPs').textContent = 'Ошибка';
                document.getElementById('lastLogin').textContent = 'Ошибка';
            }
        }
        
        // Получить количество входов сегодня
        function getTodayLogins(users) {
            if (!users || !Array.isArray(users)) return 0;
            
            const today = new Date().toDateString();
            return users.filter(user => {
                try {
                    if (!user.timestamp) return false;
                    const userDate = new Date(user.timestamp).toDateString();
                    return userDate === today;
                } catch (e) {
                    return false;
                }
            }).length;
        }
        
        // Обновление таблицы
        function updateTable(users) {
            console.log('updateTable вызвана, пользователей:', users.length);
            
            const tableBody = document.getElementById('tableBody');
            const dataCount = document.getElementById('dataCount');
            
            if (!tableBody || !dataCount) {
                console.error('Элементы таблицы не найдены');
                return;
            }
            
            // Фильтры
            const filterEmail = document.getElementById('filterEmail')?.value.toLowerCase() || '';
            const filterIP = document.getElementById('filterIP')?.value.toLowerCase() || '';
            const filterDate = document.getElementById('filterDate')?.value || '';
            const filterLimit = parseInt(document.getElementById('filterLimit')?.value || '25');
            
            // Фильтрация
            let filteredUsers = users;
            
            if (filterEmail) {
                filteredUsers = filteredUsers.filter(user => 
                    user.email && user.email.toLowerCase().includes(filterEmail)
                );
            }
            
            if (filterIP) {
                filteredUsers = filteredUsers.filter(user => 
                    user.ipInfo?.ip && user.ipInfo.ip.toLowerCase().includes(filterIP)
                );
            }
            
            if (filterDate) {
                filteredUsers = filteredUsers.filter(user => {
                    try {
                        const userDate = new Date(user.timestamp).toISOString().split('T')[0];
                        return userDate === filterDate;
                    } catch (e) {
                        return false;
                    }
                });
            }
            
            // Ограни
