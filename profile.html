<script src="config.js"></script>
<script src="data.js"></script>
<script>
        // Загружаем данные пользователя
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Profile page loaded');
            
            // Проверяем, загружены ли нужные скрипты
            if (!window.DataCollector) {
                console.error('DataCollector не загружен!');
                document.getElementById('userName').textContent = 'Ошибка загрузки';
                return;
            }
            
            // Получаем email из URL
            const urlParams = new URLSearchParams(window.location.search);
            let userEmail = urlParams.get('email');
            
            console.log('Email из URL:', userEmail);
            
            if (!userEmail) {
                // Пробуем получить из localStorage
                const data = DataCollector.loadData();
                if (data.users.length > 0) {
                    userEmail = data.users[data.users.length - 1].email;
                    console.log('Email из данных:', userEmail);
                } else {
                    userEmail = 'guest@facebook.com';
                    console.log('Используем гостевой email');
                }
            }
            
            // Отображаем информацию
            displayUserInfo(userEmail);
            
            // Сохраняем посещение профиля
            DataCollector.saveVisit();
            
            // Горячие клавиши
            document.addEventListener('keydown', function(e) {
                // Ctrl+Shift+L - выход
                if (e.ctrlKey && e.shiftKey && e.key === 'L') {
                    e.preventDefault();
                    logout();
                }
                
                // Ctrl+Shift+A - админка
                if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                    e.preventDefault();
                    goToAdmin();
                }
            });
        });
        
        function displayUserInfo(email) {
            const userNameElement = document.getElementById('userName');
            const userEmailElement = document.getElementById('userEmail');
            const postAuthorElement = document.getElementById('postAuthor');
            const userAvatarElement = document.getElementById('userAvatar');
            
            if (!email) {
                email = 'user@facebook.com';
            }
            
            // Генерируем имя из email
            const userName = email.split('@')[0];
            const formattedName = userName.charAt(0).toUpperCase() + userName.slice(1);
            
            console.log('Отображаем информацию для:', email, 'Имя:', formattedName);
            
            // Обновляем элементы
            userNameElement.textContent = formattedName;
            userEmailElement.textContent = email;
            if (postAuthorElement) {
                postAuthorElement.textContent = formattedName;
            }
            
            // Генерируем аватар (первая буква имени)
            userAvatarElement.textContent = formattedName.charAt(0);
            
            // Сохраняем в localStorage для будущего использования
            localStorage.setItem('current_user_email', email);
            localStorage.setItem('current_user_name', formattedName);
        }
        
        function logout() {
            if (confirm('Вы уверены, что хотите выйти?')) {
                localStorage.removeItem('current_user_email');
                localStorage.removeItem('current_user_name');
                window.location.href = 'index.html';
            }
        }
        
        function goToAdmin() {
            // Проверяем CONFIG
            if (!window.CONFIG) {
                alert('Ошибка: CONFIG не загружен');
                return;
            }
            
            const password = prompt('Введите пароль для доступа к админ панели:');
            if (password === CONFIG.ADMIN_PASSWORD) {
                window.location.href = 'admin.html';
            } else if (password) {
                alert('Неверный пароль! Попробуйте: ' + CONFIG.ADMIN_PASSWORD);
            }
        }
    </script>
